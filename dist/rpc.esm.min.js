var l=class{events={};on(t,r){typeof this.events[t]!="object"&&(this.events[t]=[]),this.events[t].push(r);let s=this,n=function(){s.removeListener(t,r)};return!/^(#has-listeners|#no-listeners)$/.test(t)&&this.events[t].length==1&&this.emit("#has-listeners",t),n}removeListener(t,r){var s;typeof this.events[t]=="object"&&(s=this.events[t].indexOf(r),s>-1&&(this.events[t].splice(s,1),!/^(#has-listeners|#no-listeners)$/.test(t)&&this.events[t].length==0&&this.emit("#no-listeners",t)))}emit(t){if(typeof this.events[t]=="object"){var r,s,n,i=[].slice.call(arguments,1);for(s=this.events[t].slice(),n=s.length,r=0;r<n;r++)try{s[r].apply(this,i)}catch(a){console.error(t,i),console.error(a)}}}once(t,r){return this.on(t,function s(){this.removeListener(t,s),r.apply(this,arguments)})}waitForEvent(t,r=0){return new Promise(s=>{let n,i=this.on(t,()=>{r>0&&clearTimeout(n),i(),s(!0)});r>0&&(n=setTimeout(()=>{i(),s(!1)},r))})}waitForAnyEvent(t,r=0){return new Promise(s=>{let n,i=[],a=()=>{r>0&&clearTimeout(n),i.forEach(d=>{d()}),s(!0)};t.forEach(d=>{i.push(this.on(d,a))}),r>0&&(n=setTimeout(()=>{a(),s(!1)},r))})}clear(){this.events={}}destroy(){this.clear()}clearEventListeners(t){(this.events[t]||[]).length>0&&(this.events[t]=[],this.emit("#no-listeners",t))}onHasEventListeners(t){return this.on("#has-listeners",t)}onNoEventListeners(t){return this.on("#no-listeners",t)}};var c={code:-32700,message:"Parse error"},A={code:-32600,message:"Invalid Request"},D={code:-32601,message:"Method not found"},L={code:-32602,message:"Invalid params"},F={code:-32603,message:"Internal error"},g=class{code=0;message="";data={};constructor(t){t instanceof Error?(this.message=t.message,this.data=t):typeof t=="string"?this.message=t:(this.code=t.code||0,this.message=t.message||"",this.data=t.data||{})}},o=class{error;id;constructor(t,r){this.error=new g(t),this.id=r||null}},u=class{result;id;constructor(t,r){this.result=t,this.id=r||null}},w=class{data=[];total=0;page_size=0;current_page=0;total_pages=0;constructor(t){if(!Array.isArray(t.data))throw console.error(t),new Error("data must be an array");let r=typeof t.total=="number"?t.total:parseInt(t.total),s=typeof t.page_size=="number"?t.page_size:parseInt(t.page_size),n=typeof t.current_page=="number"?t.current_page:parseInt(t.current_page),i=typeof t.total_pages=="number"?t.total_pages:parseInt(t.total_pages);if(isNaN(r))throw console.error(t),new Error("total must be a number");if(isNaN(s))throw console.error(t),new Error("page_size must be a number");if(isNaN(n))throw console.error(t),new Error("current_page must be a number");if(isNaN(i))throw console.error(t),new Error("total_pages must be a number");this.data=t.data,this.total=t.total,this.page_size=t.page_size,this.current_page=t.current_page,this.total_pages=t.total_pages}},f=class{result;id;constructor(t,r){this.result=new w(t),this.id=r||null}},y=class{#t=new l;on(t,r){this.#t.on(t,r)}notify(t){t&&t.id&&typeof t.id=="string"&&(t.hasOwnProperty("error")||t.hasOwnProperty("result"))&&setTimeout(()=>this.#t.emit(t.id,t),0)}},E=new y;function h(e){return e&&(e.hasOwnProperty("error")||e.hasOwnProperty("result"))}function p(e,t=null){if(!h(e))return console.error(e),new o(c,t);if(e.error)return new o(e.error,e.id||t);if(e.result)return!1}function b(e,t=null){if(!h(e))return console.error(e),new o(c,t);let r=p(e);if(r)return r;try{return new f(e.result,e.id)}catch(s){return console.error(s),new o(s,e.id||t)}}function R(e){if(!h(e))return console.error(e),!1;if(e.error)return!1;if(e.result)return e.result.hasOwnProperty("total_pages")&&e.result.hasOwnProperty("current_page")&&e.result.hasOwnProperty("page_size")&&e.result.hasOwnProperty("total")&&e.result.hasOwnProperty("data")}function N(e,t){if(!h(e))return console.error(e),new o(c,t);let r=p(e);return r||new u(e.result,e.id||t)}function P(e){return e.error?"error":e.result?R(e)?"pagedData":"data":"error"}function v(e={},t={}){if(t.notify=t.hasOwnProperty("notify")?t.notify:!0,!h(e))return new o(c,t.id);let r=P(e),s;return r==="error"?s=new o(e.error,e.id||t.id):r==="data"?s=N(e,e.id||t.id):r==="pagedData"&&(s=b(e,e.id||t.id)),t.notify&&E.notify(s),s}async function _(e,t,r={}){try{let i=await(await(r.fetch||fetch)(e,t)).json();return v(i,r)}catch(s){return console.error(s),new o(s,r.id)}}async function S(e,t,r={}){let s=await _(e,t,r);return s instanceof f?new u(s.result,s.id):s}async function j(e,t,r={}){let s=await _(e,t,r);return s instanceof u?new o(c,s.id):s}var m=class{constructor(t,r,s){this.jsonrpc="2.0",this.id=s||null,this.method=t,this.params=r||{}}toJSON(){return{jsonrpc:this.jsonrpc,id:this.id,method:this.method,params:this.params}}toString(){return JSON.stringify({jsonrpc:this.jsonrpc,id:this.id,method:this.method,params:this.params})}toFormData(){let t=new FormData;t.append("jsonrpc",this.jsonrpc),this.id&&t.append("id",this.id),t.append("method",this.method);let r=Object.entries(this.params);r.length==0&&(r=[["value",1]]);for(let[s,n]of r){let i=n instanceof Blob?n:String(n);t.append(`params[${s}]`,i)}return t}};export{u as RPCDataResponse,o as RPCErrorResponse,f as RPCPagedResponse,m as RPCRequestBody,F as RPC_INTERNAL_ERROR,L as RPC_INVALID_PARAMS,A as RPC_INVALID_REQUEST,D as RPC_METHOD_NOT_FOUND,c as RPC_PARSE_ERROR,v as extractRPCResponse,E as responseEventHandler,S as rpcFetchData,j as rpcFetchPageData};
