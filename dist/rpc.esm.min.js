var a=class{events={};on(t,r){typeof this.events[t]!="object"&&(this.events[t]=[]),this.events[t].push(r);let s=this,n=function(){s.removeListener(t,r)};return!/^(#has-listeners|#no-listeners)$/.test(t)&&this.events[t].length==1&&this.emit("#has-listeners",t),n}removeListener(t,r){var s;typeof this.events[t]=="object"&&(s=this.events[t].indexOf(r),s>-1&&(this.events[t].splice(s,1),!/^(#has-listeners|#no-listeners)$/.test(t)&&this.events[t].length==0&&this.emit("#no-listeners",t)))}emit(t){if(typeof this.events[t]=="object"){var r,s,n,i=[].slice.call(arguments,1);for(s=this.events[t].slice(),n=s.length,r=0;r<n;r++)try{s[r].apply(this,i)}catch(l){console.error(t,i),console.error(l)}}}once(t,r){return this.on(t,function s(){this.removeListener(t,s),r.apply(this,arguments)})}waitForEvent(t,r=0){return new Promise(s=>{let n,i=this.on(t,()=>{r>0&&clearTimeout(n),i(),s(!0)});r>0&&(n=setTimeout(()=>{i(),s(!1)},r))})}waitForAnyEvent(t,r=0){return new Promise(s=>{let n,i=[],l=()=>{r>0&&clearTimeout(n),i.forEach(g=>{g()}),s(!0)};t.forEach(g=>{i.push(this.on(g,l))}),r>0&&(n=setTimeout(()=>{l(),s(!1)},r))})}clear(){this.events={}}destroy(){this.clear()}clearEventListeners(t){(this.events[t]||[]).length>0&&(this.events[t]=[],this.emit("#no-listeners",t))}onHasEventListeners(t){return this.on("#has-listeners",t)}onNoEventListeners(t){return this.on("#no-listeners",t)}};var c={code:-32700,message:"Parse error"},j={code:-32600,message:"Invalid Request"},z={code:-32601,message:"Method not found"},A={code:-32602,message:"Invalid params"},L={code:-32603,message:"Internal error"},p=class{code=0;message="";data={};constructor(t){t instanceof Error?(this.message=t.message,this.data=t):typeof t=="string"?this.message=t:(this.code=t.code||0,this.message=t.message||"",this.data=t.data||{})}},o=class{error;id;constructor(t,r){this.error=new p(t),this.id=r||null}},u=class{result;id;constructor(t,r){this.result=t,this.id=r||null}},d=class{data=[];total=0;page_size=0;current_page=0;total_pages=0;constructor(t){if(!Array.isArray(t.data))throw console.error(t),new Error("data must be an array");let r=typeof t.total=="number"?t.total:parseInt(t.total),s=typeof t.page_size=="number"?t.page_size:parseInt(t.page_size),n=typeof t.current_page=="number"?t.current_page:parseInt(t.current_page),i=typeof t.total_pages=="number"?t.total_pages:parseInt(t.total_pages);if(isNaN(r))throw console.error(t),new Error("total must be a number");if(isNaN(s))throw console.error(t),new Error("page_size must be a number");if(isNaN(n))throw console.error(t),new Error("current_page must be a number");if(isNaN(i))throw console.error(t),new Error("total_pages must be a number");this.data=t.data,this.total=t.total,this.page_size=t.page_size,this.current_page=t.current_page,this.total_pages=t.total_pages}},f=class{result;id;constructor(t,r){this.result=new d(t),this.id=r||null}},w=class{#t=new a;on(t,r){this.#t.on(t,r)}notify(t){t&&t.id&&typeof t.id=="string"&&(t.hasOwnProperty("error")||t.hasOwnProperty("result"))&&setTimeout(()=>this.#t.emit(t.id,t),0)}},b=new w;function h(e){return e&&(e.hasOwnProperty("error")||e.hasOwnProperty("result"))}function y(e,t=null){if(!h(e))return console.error(e),new o(c,t);if(e.error)return new o(e.error,e.id||t);if(e.result)return!1}function E(e,t=null){if(!h(e))return console.error(e),new o(c,t);let r=y(e);if(r)return r;try{return new f(e.result,e.id)}catch(s){return console.error(s),new o(s,e.id||t)}}function R(e){if(!h(e))return console.error(e),!1;if(e.error)return!1;if(e.result)return e.result.hasOwnProperty("total_pages")&&e.result.hasOwnProperty("current_page")&&e.result.hasOwnProperty("page_size")&&e.result.hasOwnProperty("total")&&e.result.hasOwnProperty("data")}function O(e,t){if(!h(e))return console.error(e),new o(c,t);let r=y(e);return r||new u(e.result,e.id||t)}function N(e){return e.error?"error":e.result?R(e)?"pagedData":"data":"error"}function P(e,t=null,r=!0){if(!h(e))return new o(c,t);let s=N(e),n;return s==="error"?n=new o(e.error,t):s==="data"?n=O(e,t):s==="pagedData"&&(n=E(e,t)),r&&b.notify(n),n}async function _(e,t,r=null,s=!0){try{let i=await(await fetch(e,t)).json();return P(i,r,s)}catch(n){return console.error(n),new o(n,r)}}async function F(e,t,r=null,s=!0){let n=await _(e,t,r,s);return n instanceof f?new u(n.result,n.id):n}async function S(e,t,r=null,s=!0){let n=await _(e,t,r,s);return n instanceof u?new o(c,n.id):n}var m=class{constructor(t,r,s){this.jsonrpc="2.0",this.id=s||null,this.method=t,this.params=r||{}}toJSON(){return{jsonrpc:this.jsonrpc,id:this.id,method:this.method,params:this.params}}toString(){return JSON.stringify({jsonrpc:this.jsonrpc,id:this.id,method:this.method,params:this.params})}toFormData(){let t=new FormData;t.append("jsonrpc",this.jsonrpc),this.id&&t.append("id",this.id),t.append("method",this.method);let r=Object.entries(this.params);r.length==0&&(r=[["value",1]]);for(let[s,n]of r){let i=n instanceof Blob?n:String(n);t.append(`params[${s}]`,i)}return t}};export{u as RPCDataResponseMessage,o as RPCErrorResponseMessage,f as RPCPagedResponseMessage,m as RPCRequestMessage,L as RPC_INTERNAL_ERROR,A as RPC_INVALID_PARAMS,j as RPC_INVALID_REQUEST,z as RPC_METHOD_NOT_FOUND,c as RPC_PARSE_ERROR,P as extractRPCResponse,b as responseEventHandler,F as rpcFetchData,S as rpcFetchPageData};
